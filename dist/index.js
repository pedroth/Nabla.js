!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Nabla=e():t.Nabla=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"Canvas",(function(){return m})),r.d(e,"Canvas2D",(function(){return w})),r.d(e,"ImageIO",(function(){return a})),r.d(e,"Stream",(function(){return I})),r.d(e,"ArrayUtils",(function(){return M})),r.d(e,"Sort",(function(){return A})),r.d(e,"EditDistance",(function(){return E}));const n={getImageCanvas:t=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");return r.fillStyle="rgba(0, 0, 0, 0)",r.globalCompositeOperation="source-over",r.fillRect(0,0,e.width,e.height),r.drawImage(t,0,0),e},getDataFromImage:t=>(canvas=n.getImageCanvas(t),canvas.getContext("2d").getImageData(0,0,t.width,t.height)),loadImage:t=>{const e=new Image;return e.src=t,e.isReady=!1,e.onload=()=>e.isReady=!0,e},generateImageReadyPredicate:t=>()=>t.isReady};var a=n;function i(t,e){var r=[];return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function o(t){var e=[];return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function s(t,e){var r=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}function h(t,e){return t[0]*e[0]+t[1]*e[1]}function c(t){return h(t,t)}function u(t){return Math.sqrt(h(t,t))}function f(t,e){var r=[];return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r}function l(t,e){var r=[];return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r}function p(t,e,r){var n=r[1]/t[1];return[n,(-t[0]*n+r[0])/e]}function g(t,e,r){var n=r[0]/t[0];return[n,(-t[1]*n+r[1])/e]}var d=function(t){this.canvas=t,this.ctx=t.getContext("2d"),this.image=this.ctx.getImageData(0,0,t.width,t.height),this.imageData=this.image.data};d.prototype.getSize=function(){return[this.canvas.height,this.canvas.width]},d.prototype.paintImage=function(){this.ctx.putImageData(this.image,0,0)},d.prototype.getCanvas=function(){return this.canvas},d.prototype.clearImage=function(t){this.useCanvasCtx(e=>{var r=e.getSize();e.ctx.fillStyle="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",e.ctx.globalCompositeOperation="source-over",e.ctx.fillRect(0,0,r[1],r[0])},!0)},d.prototype.useCanvasCtx=function(t,e=!1){e||this.ctx.putImageData(this.image,0,0),t(this),this.image=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),this.imageData=this.image.data},d.prototype.getImageIndex=function(t){return 4*(this.canvas.width*t[0]+t[1])},d.prototype.getPxl=function(t){var e=this.getImageIndex(t);return[this.imageData[e],this.imageData[e+1],this.imageData[e+2],this.imageData[e+3]]},d.prototype.drawPxl=function(t,e){var r=this.getImageIndex(t);this.imageData[r]=e[0],this.imageData[r+1]=e[1],this.imageData[r+2]=e[2],this.imageData[r+3]=e[3]},d.prototype.drawLine=function(t,e,r){r.points=[t,e];var n=[];n.push(t),n.push(e);for(var a=[],i=[],o=0;o<n.length;o++){0<=(l=n[o])[0]&&l[0]<this.canvas.height&&0<=l[1]&&l[1]<this.canvas.width?a.push(l):i.push(l)}if(2!=a.length){var c=[],u=[e[0]-t[0],e[1]-t[1]];c.push(p(u,-(this.canvas.height-1),[-t[0],-t[1]])),c.push(g(u,-(this.canvas.width-1),[this.canvas.height-1-t[0],-t[1]])),c.push(p(u,this.canvas.height-1,[this.canvas.height-1-t[0],this.canvas.width-1-t[1]])),c.push(g(u,this.canvas.width-1,[-t[0],this.canvas.width-1-t[1]]));var f=[];for(o=0;o<c.length;o++){var l;0<=(l=c[o])[0]&&l[0]<=1&&0<=l[1]&&l[1]<=1&&f.push(l)}if(0!=f.length)if(a.length>0){var d=[t[0]+f[0][0]*u[0],t[1]+f[0][0]*u[1]];this.drawLineInt(a.pop(),d,r)}else{var m=[t[0]+f[0][0]*u[0],t[1]+f[0][0]*u[1]];for(o=1;o<f.length;o++){if(h(u=s(d=[t[0]+f[o][0]*u[0],t[1]+f[o][0]*u[1]],m),u)>.001)return void this.drawLineInt(m,d,r)}this.drawLineInt(m,m,r)}}else this.drawLineInt(a[0],a[1],r)},d.prototype.drawLineInt=function(t,e,r){t=o(t),e=o(e);var n=[-1,0,1],a=n.length,c=a*a,u=[];u[0]=t[0],u[1]=t[1];var f=s(e,t),l=[];for(l[0]=-f[1],l[1]=f[0],r(u,r.points,this);u[0]!==e[0]||u[1]!==e[1];){for(var p=Number.MAX_VALUE,g=[],d=0;d<c;d++){var m=n[d%a],y=n[Math.floor(d/a)],v=s(i(u,[m,y]),t),w=Math.abs(h(v,l))-h(v,f);p>w&&(p=w,g=[m,y])}r(u=i(u,g),r.points,this)}r(u,r.points,this)},d.prototype.drawPolygon=function(t,e,r=d.isInsidePolygon){let n=[[Number.MAX_VALUE,Number.MAX_VALUE],[Number.MIN_VALUE,Number.MIN_VALUE]];for(let e=0;e<t.length;e++)n[0]=f(t[e],n[0]),n[1]=l(t[e],n[1]);let a=s(this.getSize(),[1,1]),i=[0,0];n[0]=o(f(a,l(i,n[0]))),n[1]=o(f(a,l(i,n[1])));for(var h=n[0][0];h<n[1][0];h++)for(var c=n[0][1];c<n[1][1];c++){var u=[h,c];r(u,t)&&e(u,t,this)}},d.prototype.drawTriangle=function(t,e,r,n){var a=[t,e,r];this.drawPolygon(a,n,d.isInsideConvex)},d.prototype.drawQuad=function(t,e,r,n,a){this.drawPolygon([t,e,r,n],a)},d.prototype.drawImage=function(t,e){"isReady"in t&&!t.isReady||this.useCanvasCtx(r=>r.ctx.drawImage(t,e[1],e[0]))},d.prototype.drawCircle=function(t,e,r){var n=function(t,e){var r=[];return r[0]=t[0]*e,r[1]=t[1]*e,r}([1,1],e),a=[s(t,n),i(t,n)],h=this.getSize();a[0]=o(f(s(h,[1,1]),l([0,0],a[0]))),a[1]=o(f(s(h,[1,1]),l([0,0],a[1])));for(var c=a[0][0];c<=a[1][0];c++)for(var u=a[0][1];u<=a[1][1];u++){var p=[c,u];this.isInsideCircle(p,t,e)&&r(p,[t,e],this)}},d.prototype.isInsideCircle=function(t,e,r){return c(s(t,e))<=r*r},d.prototype.addEventListener=function(t,e,r){this.canvas.addEventListener(t,e,r)},d.prototype.drawString=function(t,e,r){this.useCanvasCtx(n=>{r(n.ctx),n.ctx.fillText(e,t[1],t[0])})},d.isInsidePolygon=function(t,e){for(var r=[],n=0,a=e.length,i=0;i<a;i++)r[0]=s(e[(i+1)%a],t),r[1]=s(e[i],t),n+=Math.acos(h(r[0],r[1])/(u(r[0])*u(r[1])));return Math.abs(n-2*Math.PI)<.001},d.isInsideConvex=function(t,e){for(var r=e.length,n=[],a=[],i=0;i<r;i++){n[i]=s(e[(i+1)%r],e[i]);let o=[-n[i][1],n[i][0]],c=s(t,e[i]);a[i]=h(c,o)}let o=n[0][0]*n[1][1]-n[0][1]*n[1][0]>0?1:-1;for(i=0;i<r;i++){if(a[i]*o<0)return!1}return!0},d.simpleShader=function(t){return(e,r,n)=>n.drawPxl(e,t)},d.colorShader=function(t){return d.interpolateTriangleShader((e,r,n,a)=>{for(var i=[0,0,0,0],o=0;o<r.length;o++)i[0]=i[0]+t[o][0]*a[o],i[1]=i[1]+t[o][1]*a[o],i[2]=i[2]+t[o][2]*a[o],i[3]=i[3]+t[o][3]*a[o];n.drawPxl(e,i)})},d.interpolateQuadShader=function(t){return function(e,r,n){var a=[r[0],r[1],r[2]],i=[r[2],r[3],r[0]],o=d.triangleBaryCoord(e,a);o[0]>0&&o[1]>0&&o[2]>0&&Math.abs(o[0]+o[1]+o[2]-1)<1e-10?t(e,r,n,[o[0],o[1],o[2],0]):(o=d.triangleBaryCoord(e,i),t(e,r,n,[o[2],0,o[0],o[1]]))}},d.interpolateTriangleShader=function(t){return(e,r,n)=>{alpha=d.triangleBaryCoord(e,r),t(e,r,n,alpha)}},d.interpolateLineShader=function(t){return(e,r,n)=>{var a=s(r[1],r[0]),i=s(e,r[0]),o=c(a),u=h(i,a);t(e,r,n,0==o?0:u/o)}},d.quadTextureShader=function(t,e,r=d.bilinearInterpolation){let n=null;return d.interpolateQuadShader((h,c,u,p)=>{t.isReady&&null!=n||(n=new d(a.getImageCanvas(t)));const g=n,m=g.getSize(),y=[0,0];for(let t=0;t<e.length;t++)y[0]=y[0]+e[t][0]*p[t],y[1]=y[1]+e[t][1]*p[t];var v=[(1-y[1])*(m[1]-1),(m[0]-1)*y[0]],w=o(v=l([0,0],f(s([m[0],m[1]],[1,1]),v))),x=[g.getPxl(w),g.getPxl(i(w,[1,0])),g.getPxl(i(w,[1,1])),g.getPxl(i(w,[0,1]))],S=r(x,s(v,w));u.drawPxl(h,S)})},d.triangleCache=(()=>{const t=[];return{constains:e=>null!=t[e%3],get:e=>t[e%3],set:(e,r)=>t[e%3]=r}})(),d.triangleHash=t=>[t[0][0],t[1][0],t[2][0],t[0][1],t[1][1],t[2][1]].reduce((t,e)=>31*t+e,1),d.triangleBaryCoord=function(t,e){const r=d.triangleHash(e),n=[t[0]-e[0][0],t[1]-e[0][1]];if(!d.triangleCache.constains(r)){const t=[e[1][0]-e[0][0],e[1][1]-e[0][1]],n=[e[2][0]-e[0][0],e[2][1]-e[0][1]],a=t[0]*n[1]-t[1]*n[0];d.triangleCache.set(r,{triangle:e,u:t.map(t=>t/a),v:n.map(t=>t/a),det:a,hash:r})}const a=d.triangleCache.get(r),i=a.u,o=a.v;if(0==a.det)return[0,0,0];var s=[o[1]*n[0]-o[0]*n[1],i[0]*n[1]-i[1]*n[0]];return[1-s[0]-s[1],s[0],s[1]]},d.bilinearInterpolation=function(t,e){for(var r=[],n=0;n<t.length;n++){var a=t[0][n]+(t[3][n]-t[0][n])*e[1],i=a+(t[1][n]+(t[2][n]-t[1][n])*e[1]-a)*e[0];r.push(i)}return r},d.createCanvas=function(t,e){const r=document.createElement("canvas");return r.setAttribute("width",t[0]),r.setAttribute("height",t[1]),document.getElementById(e).appendChild(r),r};var m=d,v=function(t,e){if(m.call(this,t),2!=e.length||2!=e[0].length&&2!=e[1].length)throw"camera space must be 2-dim array with 2-dim arrays representing an interval";this.cameraSpace=e};(v.prototype=Object.create(m.prototype)).constructor=v,v.prototype.integerTransform=function(t){return[-(this.canvas.height-1)/(this.cameraSpace[1][1]-this.cameraSpace[1][0])*(t[1]-this.cameraSpace[1][1]),(this.canvas.width-1)/(this.cameraSpace[0][1]-this.cameraSpace[0][0])*(t[0]-this.cameraSpace[0][0])]},v.prototype.inverseTransform=function(t){return[this.cameraSpace[0][0]+(this.cameraSpace[0][1]-this.cameraSpace[0][0])/(this.canvas.width-1)*t[1],this.cameraSpace[1][1]-(this.cameraSpace[1][1]-this.cameraSpace[1][0])/(this.canvas.height-1)*t[0]]},v.prototype.drawLine=function(t,e,r){y1=this.integerTransform(t),y2=this.integerTransform(e),m.prototype.drawLine.call(this,y1,y2,r)},v.prototype.drawTriangle=function(t,e,r,n){y1=this.integerTransform(t),y2=this.integerTransform(e),y3=this.integerTransform(r),m.prototype.drawTriangle.call(this,y1,y2,y3,n)},v.prototype.drawQuad=function(t,e,r,n,a){y1=this.integerTransform(t),y2=this.integerTransform(e),y3=this.integerTransform(r),y4=this.integerTransform(n),m.prototype.drawQuad.call(this,y1,y2,y3,y4,a)},v.prototype.drawCircle=function(t,e,r){y=this.integerTransform(t),z=this.integerTransform([e,0])[1]-this.integerTransform([0,0])[1],m.prototype.drawCircle.call(this,y,z,r)},v.prototype.drawImage=function(t,e){m.prototype.drawImage.call(this,t,this.integerTransform(e))},v.prototype.drawString=function(t,e,r){y=this.integerTransform(t),m.prototype.drawString.call(this,y,e,r)},v.prototype.setCamera=function(t){if(2!=t.length||2!=t[0].length&&2!=t[1].length)throw"camera space must be 2-dim array with 2-dim arrays representing an interval";this.cameraSpace=t};var w=v;const x=function(t){this.f=t};x.prototype.compose=function(t){return new x(e=>this.f(t(e)))},x.prototype.leftCompose=function(t){return new x(e=>t(this.f(e)))},x.prototype.apply=function(t){return this.f(t)},x.prototype.get=function(){return this.f},x.of=function(t){return new x(t)};var S=x,b=function(t,e=(t=>t),r=(t=>!0)){this.gen=t,this.mapFunction=e,this.filterPredicate=r};b.prototype.state=function(){return this.gen.state},b.prototype.hasNext=function(){return this.gen.hasNext(this.filteredState())},b.prototype.filteredState=function(){for(var t=this.state();this.gen.hasNext(t)&&!this.filterPredicate(this.gen.peek(t));)t=this.gen.next(t);return t},b.prototype.head=function(){let t=this.filteredState();if(this.gen.hasNext(t))return this.gen.peek(t);throw"No head element exception"},b.prototype.tail=function(){return new b(b.generatorOf(this.gen.next(this.filteredState()),this.gen.next,this.gen.peek,this.gen.hasNext),this.mapFunction,this.filterPredicate)},b.prototype.map=function(t){return new b(this.gen,S.of(t).compose(this.mapFunction).get(),this.filterPredicate)},b.prototype.reduce=function(t,e){for(var r=this;r.hasNext();){let n=r.head();t=e(t,r.mapFunction(n)),r=r.tail()}return t},b.prototype.forEach=function(t){for(var e=this;e.hasNext();){let r=e.head();t(e.mapFunction(r)),e=e.tail()}},b.prototype.collect=function(t){return this.reduce(t.identity,t.reduce)},b.prototype.filter=function(t){return new b(this.gen,this.mapFunction,e=>this.filterPredicate(e)&&t(e))},b.prototype.take=function(t){return new b(b.generatorOf({i:0,stream:this},t=>({i:t.i+1,stream:t.stream.tail()}),t=>t.stream.head(),e=>e.stream.hasNext()&&e.i<t),this.mapFunction,this.filterPredicate).collect(b.Collectors.toArray())},b.prototype.takeWhile=function(t){return new b(b.generatorOf(this,t=>t.tail(),t=>t.head(),e=>e.hasNext()&&t(e.head())),this.mapFunction,this.filterPredicate).collect(b.Collectors.toArray())},b.prototype.zip=function(t){return new b(b.generatorOf([this,t],t=>[t[0].tail(),t[1].tail()],t=>[t[0].head(),t[1].head()],t=>t[0].hasNext()&&t[1].hasNext()))},b.prototype.flatMap=function(t){return new b(b.generatorOf({baseStream:this,flatStream:null},e=>{if(!e.flatStream||!e.flatStream.hasNext()){let r=e.baseStream;return{baseStream:r.tail(),flatStream:t(r.head()).tail()}}return{baseStream:e.baseStream,flatStream:e.flatStream.tail()}},e=>e.flatStream&&e.flatStream.hasNext()?e.flatStream.head():t(e.baseStream.head()).head(),e=>e.flatStream?e.baseStream.hasNext()||e.flatStream.hasNext():e.baseStream.hasNext()&&t(e.baseStream.head()).hasNext()))},b.ofHeadTail=function(t,e){return new b(b.generatorOf({h:t,supplier:e},t=>{let e=t.supplier();return e.hasNext()?{h:e.head(),supplier:()=>e.tail()}:{h:null,supplier:null}},t=>t.h,t=>null!=t.h))},b.of=function(t){var e=[{name:"Array",predicate:t=>t.constructor===Array},{name:"Generator",predicate:t=>"function"==typeof t.hasNext&&"function"==typeof t.next&&"function"==typeof t.peek},{name:"Stream",predicate:t=>t.__proto__==b.prototype}],r={Array:t=>new b(b.generatorOf({i:0,array:t},t=>({i:t.i+1,array:t.array}),t=>t.array[t.i],t=>t.i<t.array.length)),Generator:t=>new b(t),Stream:t=>new b(t.gen,t.mapFunction,t.filterPredicate)};for(let n=0;n<e.length;n++)if(e[n].predicate(t))return r[e[n].name](t);throw`Iterable ${t} does not have a stream`},b.range=function(t,e,r=1){return new b(b.generatorOf(t,t=>t+r,t=>t,t=>null==e||t<e))},b.generatorOf=function(t,e,r,n){return new function(){this.state=t,this.next=e,this.peek=r,this.hasNext=n}},b.Collectors={toArray:()=>new function(){this.identity=[],this.reduce=(t,e)=>(t.push(e),t)}};var I=b,C={concat:function(t,e){return t.concat(e)},arrayEquals:function(t,e){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!=e[r])return!1;return!0},permute:function(t,e){for(var r=t.slice(),n=Math.min(t.length,e.length),a=0;a<n;a++)r[e[a]]=t[a];return r},randomPermute:function(t){const e=[...t];for(let r=t.length-1;r>0;r--){const t=Math.floor(Math.random()*(r+1)),n=e[r];e[r]=e[t],e[t]=n}return e},swap:function(t,e,r){var n=t[e];return t[e]=t[r],t[r]=n,t},findJsArrayDim:function(t){return t instanceof Array?C.concat(C.findJsArrayDim(t[0]),[t.length]):[]},unpackJsArray:function(t){if(t instanceof Array){for(var e=[],r=0;r<t.length;r++)e=C.concat(e,C.unpackJsArray(t[r]));return e}return[t]},range:function(t,e,r=1){for(var n=[],a=t;a<e;a+=r)n.push(a);return n},binaryOp:function(t,e,r){var n=t.length<e.length?t.slice():e.slice();for(let a=0;a<n.length;a++)n[a]=r(t[a],e[a]);return n},map:function(t,e){const r=[];for(let n=0;n<t.length;n++)r.push(e(t[n],n));return r},filter:function(t,e){const r=[];for(let n=0;n<t.length;n++)e(t[n],n)&&r.push(t[n]);return r},forEach:function(t,e){for(let r=0;r<t.length;r++)e(t[r],r)}},M=C;const N={};function P(t,e,r){if(e>=0&&e<t.length&&r>=0&&r<t.length){var n=t[e];t[e]=t[r],t[r]=n}}N.quicksort=function(t,e=((t,e)=>t-e)){const r=t.length,n=[...t],a=[];for(a.push(0),a.push(r-1);a.length>0;){const t=a.pop(),r=a.pop();if(r<t){const i=r+Math.floor((t-r)*Math.random()),o=n[i];P(n,i,t);let s=r;for(let a=r;a<t;a++)e(n[a],o)<=0&&(P(n,a,s),s++);P(n,s,t),a.push(r),a.push(s-1),a.push(s+1),a.push(t)}}return n},N.REVERSE_SORT_COMPARATOR=(t,e)=>e-t;var A=N;const T={distanceFactory:(t=1,e=1,r=1)=>(n,a,i=(t=>{}))=>{const o=n.length,s=a.length,h=O(o+1,s+1);for(let t=0;t<o+1;t++)h[t][0]=t*e;for(let t=0;t<s+1;t++)h[0][t]=t*r;for(let i=1;i<o+1;i++)for(let o=1;o<s+1;o++){const s=n[i-1]===a[o-1],c=h[i-1][o]+e,u=h[i][o-1]+r,f=h[i-1][o-1]+(s?0:t);h[i][o]=D(c,u,f)}return i(h,n,a),h[o][s]}};T.distance=T.distanceFactory(),T.printDistanceMatrix=(t,e,r)=>{let n=[];t.forEach((t,e)=>{let r=[];t.forEach((t,e)=>r.push(""+t)),n.push(r.join(" "))}),console.log(`w1: ${e}, w2: ${r}`,n.join("\n"))};const O=(t,e)=>Array.from(Array(t),()=>new Array(e)),D=(...t)=>t.reduce((t,e)=>Math.min(t,e),Number.MAX_VALUE);var E=T}])}));